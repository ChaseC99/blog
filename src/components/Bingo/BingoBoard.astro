---
import BingoCard from "./BingoCard.astro";

interface Props {
  items: {
    title: string;
    completed: boolean;
    completedImage?: string;
  }[];
}

const { items }: Props = Astro.props;

const hoverBackgroundCss = items
  .map((item, idx) => {
    if (!item.completed || !item.completedImage) return "";

    // Note: URLs are expected to be safe (e.g. /image.jpg). If you later pass
    // arbitrary URLs, consider escaping quotes/parens.
    return `.bingo-grid:has(.bingo-card.is-completed[data-index="${idx}"][data-completed-image]:hover) {\n  background-image: url('${item.completedImage}');\n}`;
  })
  .filter(Boolean)
  .join("\n\n");
---

<div class="bingo-grid">
    {items.map((item, idx) => (
        <BingoCard
            item={item.title}
            completed={item.completed}
            completedImage={item.completedImage}
            index={idx}
        />
    ))}
</div>

<style is:global set:html={hoverBackgroundCss} />

<style is:global>
.bingo-grid {
    --cell-size: 20%;
    display: grid;
    grid-template-columns: repeat(5, var(--cell-size));
    border: 1px solid #000;
    background-color: #fff;
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    margin: 2rem 0;
}

/* Dim the rest of the board, but keep text visible */
.bingo-grid:has(.bingo-card.is-completed[data-completed-image]:hover) .bingo-card {
    opacity: 0.4;
}

/* Don't let other completed (green) squares block the image */
.bingo-grid:has(.bingo-card.is-completed[data-completed-image]:hover) .bingo-card.is-completed {
    background: rgba(76, 175, 80, 0.35);
}

/* Keep the hovered completed card fully visible */
.bingo-grid:has(.bingo-card.is-completed[data-completed-image]:hover) .bingo-card.is-completed:hover {
    opacity: 1;
    z-index: 1;

    /* Remove this if I decide to make the hovered background also opaque */
    background: #4caf50;
}
</style>